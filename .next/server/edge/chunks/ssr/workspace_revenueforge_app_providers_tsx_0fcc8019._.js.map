{"version":3,"sources":["turbopack:///[project]/workspace/revenueforge/lib/auth-context.tsx","turbopack:///[project]/workspace/revenueforge/app/providers.tsx"],"sourcesContent":["'use client';\n\nimport {\n  createContext,\n  useContext,\n  useState,\n  useEffect,\n  useCallback,\n  ReactNode,\n} from 'react';\nimport { useRouter } from 'next/navigation';\n\n// Types\nexport interface User {\n  id: string;\n  email: string;\n  name: string;\n  company?: string;\n  role: 'admin' | 'dealer' | 'user';\n}\n\nexport interface AuthState {\n  user: User | null;\n  isLoading: boolean;\n  isAuthenticated: boolean;\n  error: string | null;\n}\n\nexport interface AuthContextType extends AuthState {\n  login: (email: string, password: string) => Promise<void>;\n  register: (name: string, email: string, password: string, company?: string) => Promise<void>;\n  logout: () => Promise<void>;\n  forgotPassword: (email: string) => Promise<void>;\n  resetPassword: (token: string, password: string) => Promise<void>;\n  clearError: () => void;\n}\n\n// Create context with a default no-op implementation for static generation\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\n// Auth provider props\ninterface AuthProviderProps {\n  children: ReactNode;\n}\n\n// Storage keys\nconst AUTH_TOKEN_KEY = 'auth_token';\nconst USER_KEY = 'user_data';\n\n// API base URL - in production, this would be an environment variable\nconst API_BASE = process.env.NEXT_PUBLIC_API_URL || '/api';\n\nexport function AuthProvider({ children }: AuthProviderProps) {\n  const router = useRouter();\n  const [state, setState] = useState<AuthState>({\n    user: null,\n    isLoading: true,\n    isAuthenticated: false,\n    error: null,\n  });\n\n  // Check for existing session on mount\n  useEffect(() => {\n    const checkAuth = async () => {\n      try {\n        const token = localStorage.getItem(AUTH_TOKEN_KEY);\n        const userData = localStorage.getItem(USER_KEY);\n\n        if (token && userData) {\n          const user = JSON.parse(userData) as User;\n          setState({\n            user,\n            isLoading: false,\n            isAuthenticated: true,\n            error: null,\n          });\n        } else {\n          setState({\n            user: null,\n            isLoading: false,\n            isAuthenticated: false,\n            error: null,\n          });\n        }\n      } catch {\n        // Clear potentially corrupted data\n        localStorage.removeItem(AUTH_TOKEN_KEY);\n        localStorage.removeItem(USER_KEY);\n        setState({\n          user: null,\n          isLoading: false,\n          isAuthenticated: false,\n          error: null,\n        });\n      }\n    };\n\n    checkAuth();\n  }, []);\n\n  // Login function\n  const login = useCallback(async (email: string, password: string) => {\n    setState((prev) => ({ ...prev, isLoading: true, error: null }));\n\n    try {\n      // In a real app, this would call your auth API\n      // For now, we simulate a successful login with mock data\n      // TODO: Replace with actual API call when backend is ready\n      \n      // Simulated API delay\n      await new Promise((resolve) => setTimeout(resolve, 500));\n\n      // Mock user data - in production, this comes from the API\n      const user: User = {\n        id: '1',\n        email,\n        name: email.split('@')[0],\n        role: email.includes('admin') ? 'admin' : email.includes('dealer') ? 'dealer' : 'user',\n      };\n\n      // Store auth data\n      const mockToken = btoa(`${email}:${Date.now()}`); // Simple mock token\n      localStorage.setItem(AUTH_TOKEN_KEY, mockToken);\n      localStorage.setItem(USER_KEY, JSON.stringify(user));\n\n      setState({\n        user,\n        isLoading: false,\n        isAuthenticated: true,\n        error: null,\n      });\n\n      // Redirect based on role\n      if (user.role === 'dealer') {\n        router.push('/dealer');\n      } else {\n        router.push('/admin');\n      }\n    } catch (error) {\n      setState({\n        user: null,\n        isLoading: false,\n        isAuthenticated: false,\n        error: 'Invalid email or password',\n      });\n      throw error;\n    }\n  }, [router]);\n\n  // Register function\n  const register = useCallback(async (\n    name: string,\n    email: string,\n    password: string,\n    company?: string\n  ) => {\n    setState((prev) => ({ ...prev, isLoading: true, error: null }));\n\n    try {\n      // In a real app, this would call your registration API\n      // For now, we simulate a successful registration\n      // TODO: Replace with actual API call when backend is ready\n      \n      await new Promise((resolve) => setTimeout(resolve, 500));\n\n      const user: User = {\n        id: Date.now().toString(),\n        email,\n        name,\n        company,\n        role: 'user',\n      };\n\n      const mockToken = btoa(`${email}:${Date.now()}`);\n      localStorage.setItem(AUTH_TOKEN_KEY, mockToken);\n      localStorage.setItem(USER_KEY, JSON.stringify(user));\n\n      setState({\n        user,\n        isLoading: false,\n        isAuthenticated: true,\n        error: null,\n      });\n\n      // Redirect to login after successful registration\n      // In a real app, you might want to auto-login or show a success message\n      router.push('/login?registered=true');\n    } catch (error) {\n      setState({\n        user: null,\n        isLoading: false,\n        isAuthenticated: false,\n        error: 'Registration failed. Please try again.',\n      });\n      throw error;\n    }\n  }, [router]);\n\n  // Logout function\n  const logout = useCallback(async () => {\n    setState((prev) => ({ ...prev, isLoading: true }));\n\n    try {\n      // Clear auth data\n      localStorage.removeItem(AUTH_TOKEN_KEY);\n      localStorage.removeItem(USER_KEY);\n\n      setState({\n        user: null,\n        isLoading: false,\n        isAuthenticated: false,\n        error: null,\n      });\n\n      // Redirect to login\n      router.push('/login');\n    } catch {\n      setState({\n        user: null,\n        isLoading: false,\n        isAuthenticated: false,\n        error: null,\n      });\n      router.push('/login');\n    }\n  }, [router]);\n\n  // Forgot password function\n  const forgotPassword = useCallback(async (email: string) => {\n    setState((prev) => ({ ...prev, isLoading: true, error: null }));\n\n    try {\n      // In a real app, this would call your password reset API\n      // TODO: Replace with actual API call when backend is ready\n      \n      await new Promise((resolve) => setTimeout(resolve, 500));\n\n      setState((prev) => ({ ...prev, isLoading: false }));\n      \n      // Return success - in production, the API would send an email\n      return;\n    } catch (error) {\n      setState((prev) => ({\n        ...prev,\n        isLoading: false,\n        error: 'Failed to send reset link. Please try again.',\n      }));\n      throw error;\n    }\n  }, []);\n\n  // Reset password function\n  const resetPassword = useCallback(async (token: string, password: string) => {\n    setState((prev) => ({ ...prev, isLoading: true, error: null }));\n\n    try {\n      // In a real app, this would call your password reset API with the token\n      // TODO: Replace with actual API call when backend is ready\n      \n      await new Promise((resolve) => setTimeout(resolve, 500));\n\n      // Validate token exists (mock validation)\n      if (!token || token.length < 10) {\n        throw new Error('Invalid or expired reset token');\n      }\n\n      setState((prev) => ({ ...prev, isLoading: false }));\n      \n      // Redirect to login after successful reset\n      router.push('/login?reset=true');\n    } catch (error) {\n      setState((prev) => ({\n        ...prev,\n        isLoading: false,\n        error: 'Invalid or expired reset token',\n      }));\n      throw error;\n    }\n  }, [router]);\n\n  // Clear error\n  const clearError = useCallback(() => {\n    setState((prev) => ({ ...prev, error: null }));\n  }, []);\n\n  const value: AuthContextType = {\n    ...state,\n    login,\n    register,\n    logout,\n    forgotPassword,\n    resetPassword,\n    clearError,\n  };\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n}\n\n// Custom hook to use auth context\nexport function useAuth(): AuthContextType {\n  const context = useContext(AuthContext);\n  \n  // During static generation or if used outside provider, return a default no-op implementation\n  if (context === undefined) {\n    // Return a safe default that won't break during static generation\n    return {\n      user: null,\n      isLoading: false,\n      isAuthenticated: false,\n      error: null,\n      login: async () => {\n        console.warn('AuthProvider not initialized - login called during static generation');\n      },\n      register: async () => {\n        console.warn('AuthProvider not initialized - register called during static generation');\n      },\n      logout: async () => {\n        console.warn('AuthProvider not initialized - logout called during static generation');\n      },\n      forgotPassword: async () => {\n        console.warn('AuthProvider not initialized - forgotPassword called during static generation');\n      },\n      resetPassword: async () => {\n        console.warn('AuthProvider not initialized - resetPassword called during static generation');\n      },\n      clearError: () => {\n        console.warn('AuthProvider not initialized - clearError called during static generation');\n      },\n    };\n  }\n  \n  return context;\n}\n\n// Export the context for advanced use cases\nexport { AuthContext };\n","'use client';\n\nimport { ReactNode } from 'react';\nimport { AuthProvider } from '@/lib/auth-context';\n\ninterface ProvidersProps {\n  children: ReactNode;\n}\n\nexport function Providers({ children }: ProvidersProps) {\n  return (\n    <AuthProvider>\n      {children}\n    </AuthProvider>\n  );\n}\n"],"names":[],"mappings":"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"}